<!-- 
===================
TASK:   text
AUTHOR: Owen Feehan
===================

===========
DESCRIPTION
===========

Finds text-regions in images.

It uses the EAST deep-CNN model via OpenCV, which generates a list of rotated bounding-boxes of proposed text regions,
each with a confidence score.

A non-maxima suppression algorithm reduces the proposals to a smaller set by eliminating significantly overlapping proposals.

The EAST model was designed to work with 1280x720 RBB images. The input image is scaled down to be approximately
similar in size.


======
INPUTS
======

RGB or grayscale images


=======
OUTPUTS
=======

objects:
    HDF5 object-masks for all the bounding-boxes that are eventually accepted

mask:
    a binary-mask combining all the object-masks in an image

outline:
    a green outline imposed on the original RGB around each object-mask


-->
<config>
<bean config-class="org.anchoranalysis.plugin.image.task.bean.segment.SegmentInstanceWithModel">
	<segment config-class="org.anchoranalysis.plugin.opencv.bean.object.segment.stack.SuppressNonMaxima">
		<segment modelBinaryPath="frozen_east_text_detection.pb" config-class="org.anchoranalysis.plugin.opencv.bean.object.segment.stack.SegmentObjectsFromTensorFlowModel">
		
			<decode minConfidence="0.8" config-class="org.anchoranalysis.plugin.opencv.bean.object.segment.decode.instance.DecodeText"/>
		    <!-- 
			     As the EAST detector was designed to work with originally 1280x720 pixel images approximately
			     we don't allow dramatically higher resolutions that this, so text objects remain roughly in
			     size proportionate to what EAST was trained on. So maxScaleFactor is approximately 720/32.
     		-->
			<scaleInput maxScaleFactor="23" config-class="org.anchoranalysis.plugin.image.bean.scale.LargestMultipleWithin">
				<minimumSize width="32" height="32" config-class="org.anchoranalysis.image.bean.spatial.SizeXY"/>
			</scaleInput>
			
			<subtractMean items="123.68,116.78,103.94" config-class="org.anchoranalysis.bean.primitive.DoubleList" config-factory="doubleList"/>
		</segment>
		<reduce config-class="org.anchoranalysis.plugin.image.bean.object.segment.reduce.ThresholdConfidence"/>
	</segment>
</bean>
</config>
