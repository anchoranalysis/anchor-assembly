<?xml version="1.0" encoding="ISO-8859-1" ?>
<config>
<bean config-class="java.util.List" config-factory="list">

	<!-- Read images using OpenCV for JPEG (because it corrects exif orientation) and otherwise Bioformats -->
	<item config-class="org.anchoranalysis.bean.NamedBean" name="org.anchoranalysis.image.io.bean.stack.reader.StackReader">
		<item config-class="org.anchoranalysis.plugin.io.bean.stack.reader.BranchExtension">
			<extensions config-class="org.anchoranalysis.bean.StringSet" config-factory="stringSet">
				<item>jpg</item>
				<item>jpeg</item>
			</extensions>		
			<readerMatching config-class="org.anchoranalysis.plugin.opencv.bean.stack.OpenCVReader"/>
			<readerNotMatching config-class="org.anchoranalysis.io.bioformats.bean.BioformatsReader">
				<options config-class="org.anchoranalysis.io.bioformats.bean.options.ForceBitsPerPixel" bitsPerPixel="8">
					<options config-class="org.anchoranalysis.io.bioformats.bean.options.ForceTimeSeriesToStack"/>
				</options>
			</readerNotMatching>
		</item>
		
	</item>
	
	<!-- Write PNGs (for single or three-channeled 2D images) or Tiffs (for single or three-channeled 3D images) or OME-TIFFs for everything else. -->
	<item config-class="org.anchoranalysis.bean.NamedBean" name="org.anchoranalysis.image.io.bean.stack.writer.StackWriter">
		<item config-class="org.anchoranalysis.plugin.io.bean.stack.writer.BranchChannels">
			
			<!--  Catch all writer that can support almost any combination of channels / stacks  -->
			<writer config-class="org.anchoranalysis.io.bioformats.bean.writer.OMETiff"/>

			<!-- If it's guaranteed to be RGB (three channels) use a PNG if guaranteed to be 2D, or a TIFF otherwise -->
			<whenRGB config-class="org.anchoranalysis.plugin.io.bean.stack.writer.BranchStack">
				<writerAlways2D config-class="org.anchoranalysis.io.imagej.bean.stack.writer.PNG"/>
				<writerElse config-class="org.anchoranalysis.io.bioformats.bean.writer.Tiff"/>
			</whenRGB>
			
			<!-- Likewise if it's guaranteed to be three channels and not RGB use a TIFF -->
			<whenThreeChannels config-class="org.anchoranalysis.io.bioformats.bean.writer.Tiff"/>
			
			<!-- Likewise if it's guaranteed to be a single non-binary channel, use a PNG if guaranteed to be 2D, or a TIFF otherwise -->
			<whenSingleChannel config-class="org.anchoranalysis.plugin.io.bean.stack.writer.BranchStack">
				<writerAlways2D config-class="org.anchoranalysis.io.imagej.bean.stack.writer.PNG"/>
				<writerElse config-class="org.anchoranalysis.io.bioformats.bean.writer.Tiff"/>
			</whenSingleChannel>
									
			<!-- Likewise if it's guaranteed to be a single binary channel, use a PNG if guaranteed to be 2D, or a TIFF otherwise -->
			<whenBinaryChannel config-class="org.anchoranalysis.plugin.io.bean.stack.writer.BranchStack">
				<writerAlways2D config-class="org.anchoranalysis.io.imagej.bean.stack.writer.PNG"/>
				<writerElse config-class="org.anchoranalysis.io.bioformats.bean.writer.Tiff"/>
			</whenBinaryChannel>
		</item>
	</item>
	
</bean>
</config>